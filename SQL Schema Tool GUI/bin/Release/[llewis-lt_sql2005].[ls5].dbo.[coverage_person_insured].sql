
-- DB Name: LS5
-- Output Date: 10/14/2008
-- Output Time: 5:20 PM
-- AutoGenerated SQL: using the SQL Schema Tool.

/*
When SET XACT_ABORT is ON, if a Transact-SQL statement raises a run-time 
error, the entire transaction is terminated and rolled back. When OFF, only the 
Transact-SQL statement that raised the error is rolled back and the transaction 
continues processing. Compile errors, such as syntax errors, are not affected by 
SET XACT_ABORT.
*/

SET QUOTED_IDENTIFIER ON
SET XACT_ABORT ON
BEGIN TRANSACTION T1 WITH MARK 'Apply Create SQL'
	
if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[coverage_person_insured]') and OBJECTPROPERTY(id, N'IsUserTable') = 1)
BEGIN
	DROP TABLE [dbo].[coverage_person_insured]
END	
GO

IF (SELECT FILEGROUP_ID('PRIMARY')) IS NOT NULL
	CREATE TABLE [dbo].[coverage_person_insured]
	( 	
		[policy_person_id] [int]  NOT NULL,
		[coverage_person_id] [int]  NOT NULL,
		[perm_flat_extra_amount] [numeric]  NULL,
		[temp_flat_extra_amount] [numeric]  NULL,
		[temp_flat_extra_period] [int]  NULL,
		[flat_extra_reason] [varchar] (100)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[temp_table_rating] [char] (20)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[temp_table_rating_reason] [varchar] (100)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[rate_class_quoted] [char] (10)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[rate_class_approved] [char] (10)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[rate_class_issued] [char] (10)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[aviation_exclusion] [int]  NULL,
		[perm_table_rating] [char] (30)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[perm_table_rating_reason] [varchar] (100)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[coverage_status] [char] (20)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[reason_text] [varchar] (100)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[is_smoker] [int]  NULL,
		[final_action_note] [varchar] (2000)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[business_ownership_percent] [numeric]  NULL,
		[final_action_by_id] [int]  NULL,
		[final_action_date] [datetime]  NULL,
		[elimination_days] [int]  NULL,
		[payout_frequency] [int]  NULL,
		[waiting_period] [int]  NULL,
		[g_number] [char] (16)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[cola] [int]  NULL,
		[own_occ] [int]  NULL,
		[spo_amount] [int]  NULL,
		[web_quoted_class] [char] (70)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[issued_times_standard] [numeric]  NULL,
		[jls_flag] [int]  NULL,
		[split_flag] [int]  NULL,
		[split_detail] [varchar] (255)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[reinsurance_company_code] [char] (10)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[reinsurance_amount] [numeric]  NULL,
		[rated_up_age] [int]  NULL,
		[paid_amount] [numeric]  NULL,
		[effective_date] [datetime]  NULL,
		[benefit_period] [char] (10)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[elimination_period] [char] (10)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[approved_benefit_period] [char] (10)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[approved_elimination_period] [char] (10)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[rate_class_prior_to_rx] [char] (10)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[past_coverage_indicator] [int]  NULL,
		[reg60_indicator] [int]  NULL,
		[medical_load_percentage] [numeric]  NULL,
		[rx_load_percentage] [numeric]  NULL,
		[industry_load_percentage] [numeric]  NULL,
		[copay_amount] [varchar] (50)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[deductable_amount] [varchar] (50)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[coinsurance_limit] [varchar] (50)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[max_out_pocket_amount] [varchar] (50)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[hsa_indicator] [int]  NULL,
		[rx_drug_option] [char] (10)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[joint_age] [int]  NULL,
		[approved_plan_code_id] [char] (10)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[guarantee_period] [varchar] (50)  COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
		[ppo_id] [int]  NULL,
		[coverage_duration] [int]  NULL,
		[do_not_offer_flag] [int]  NULL,
		[exchange_flag] [int]  NULL,
		[issue_age] [int]  NULL
	)   ON [PRIMARY] 
ELSE
	RAISERROR ('You will have to manually add the filegroup PRIMARY to the SQL DB or edit this SQL script to set the FileGroups to PRIMARY', 16, 1)
RETURN
GO

		--2nd pass thru after add/alter table columns to handle those columns having UDDTs 
	ALTER TABLE [dbo].[coverage_person_insured]
	ALTER COLUMN [policy_person_id] [int]  NOT NULL
	ALTER TABLE [dbo].[coverage_person_insured]
	ALTER COLUMN [coverage_person_id] [int]  NOT NULL
GO


IF (  (SELECT COLUMNPROPERTY( OBJECT_ID(N'coverage_person_insured'), N'coverage_person_id', 'AllowsNull')) IS NOT NULL  AND   (SELECT COLUMNPROPERTY( OBJECT_ID(N'coverage_person_insured'), N'policy_person_id', 'AllowsNull')) IS NOT NULL   ) and EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'[dbo].[coverage_person_insured]') and OBJECTPROPERTY(id, N'IsUserTable') = 1) AND (SELECT FILEGROUP_ID('PRIMARY')) IS NOT NULL
BEGIN
	ALTER TABLE [dbo].[coverage_person_insured] ADD 
	CONSTRAINT [PK_COVERAGE_PERSON_INSURED] PRIMARY KEY CLUSTERED 
	(
		[coverage_person_id], [policy_person_id]
	)  ON [PRIMARY] 
END
ELSE
	RAISERROR ('Constraint column(s): coverage_person_id, policy_person_id do(es) not exist, or Table or File Group does not exist.  Check for other errors.', 16, 1)
GO
		
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'[dbo].[coverage_person_insured]') and OBJECTPROPERTY(id, N'IsUserTable') = 1) AND (SELECT FILEGROUP_ID('PRIMARY')) IS NOT NULL
BEGIN
	CREATE  INDEX [ix_cov_pol_pers_id] ON [dbo].[coverage_person_insured]([policy_person_id]) ON [PRIMARY]
END
ELSE
	RAISERROR ('Table or File Group does not exist.  Check for other errors that caused the table to not be created.', 16, 1)
	
GO
		
IF EXISTS (SELECT * FROM dbo.sysobjects WHERE id = object_id(N'[dbo].[coverage_person_insured]') and OBJECTPROPERTY(id, N'IsUserTable') = 1) AND (SELECT FILEGROUP_ID('PRIMARY')) IS NOT NULL
BEGIN
	CREATE  INDEX [ix_cov_ppo_id] ON [dbo].[coverage_person_insured]([ppo_id]) ON [PRIMARY]
END
ELSE
	RAISERROR ('Table or File Group does not exist.  Check for other errors that caused the table to not be created.', 16, 1)
	
GO
		

DECLARE @ERR int

SET @ERR = @@ERROR
IF @@TRANCOUNT > 0
BEGIN
	IF @ERR > 0
		ROLLBACK TRANSACTION
	ELSE
		COMMIT TRANSACTION T1
END
SET XACT_ABORT OFF
	